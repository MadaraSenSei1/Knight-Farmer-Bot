<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Travian Bot UI</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 text-gray-900">
  <div class="container mx-auto p-6">
    <h1 class="text-3xl font-bold mb-6">Travian Bot - Multi Account</h1>

    <div id="accounts"></div>

    <button
      id="add-account-btn"
      class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 mt-4"
    >
      ‚ûï Add Account
    </button>
  </div>

  <script>
    let accountCounter = 0;

    document.getElementById("add-account-btn").addEventListener("click", () => {
      accountCounter++;
      const id = `acc${accountCounter}`;
      const container = document.createElement("div");
      container.className = "p-4 bg-white shadow rounded mb-4";
      container.innerHTML = `
        <h2 class="font-semibold text-lg mb-2">Account #${accountCounter}</h2>
        <input id="${id}-username" placeholder="Username" class="border p-2 mb-2 w-full" /><br>
        <input id="${id}-password" type="password" placeholder="Password" class="border p-2 mb-2 w-full" /><br>
        <input id="${id}-server" placeholder="https://tsX.travian.com" class="border p-2 mb-2 w-full" /><br>

        <div class="mb-2">Proxy:</div>
        <input id="${id}-proxy-ip" placeholder="IP" class="border p-2 mb-2 w-full" />
        <input id="${id}-proxy-port" placeholder="Port" class="border p-2 mb-2 w-full" />
        <input id="${id}-proxy-user" placeholder="Proxy Username" class="border p-2 mb-2 w-full" />
        <input id="${id}-proxy-pass" placeholder="Proxy Password" class="border p-2 mb-2 w-full" />

        <button onclick="login('${id}')" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 mt-2">
          üîê Login
        </button>

        <pre id="${id}-farm-list" class="bg-gray-100 p-2 mt-2 text-sm rounded hidden"></pre>
      `;
      document.getElementById("accounts").appendChild(container);
    });

    async function login(id) {
      const username = document.getElementById(`${id}-username`).value;
      const password = document.getElementById(`${id}-password`).value;
      const server = document.getElementById(`${id}-server`).value;

      const proxy = `${document.getElementById(`${id}-proxy-ip`).value}:${document.getElementById(`${id}-proxy-port`).value}`;
      const proxyUser = document.getElementById(`${id}-proxy-user`).value;
      const proxyPass = document.getElementById(`${id}-proxy-pass`).value;

      const fullProxy = proxyUser && proxyPass ? `http://${proxyUser}:${proxyPass}@${proxy}` : `http://${proxy}`;

      const res = await fetch('/api/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          username, password, server, proxy: fullProxy
        })
      });

      const data = await res.json();

      if (res.ok) {
        document.getElementById(`${id}-farm-list`).textContent = JSON.stringify(data.farm_lists, null, 2);
        document.getElementById(`${id}-farm-list`).classList.remove("hidden");
        alert("‚úÖ Login successful!");
      } else {
        alert("‚ùå Login failed: " + (data?.error || data?.detail || JSON.stringify(data)));
        return;
      }
    }
  </script>
</body>
</html>
